language: ruby
rvm:
  - ruby-2.7.1
  - ruby-2.6.6
  - ruby-2.5.8
  - ruby-2.4.10
  - ruby-2.3.8
  - ruby-2.2.10
  - ruby-2.1.10
  # - ruby-1.9.3-p551
  # - ruby-1.9.2
  # - ruby-2.0.0-p648
  # - jruby-head
jobs:
  include:
    - os: osx
    - os: linux
      dist: bionic
env:
  global:
    secure: OcuG1eX7hI8VR3FYI3jEsr18/AcHpTyj3MZGvHaOCK8Z4ImVTYX5wIhwXOwOyi3ROfDw5CDn85WLbzPQxTWPPOCLhuGVraQXnYCuxrwSFnO0v9qeZvcrdUkKv2bKWJQ9VYdMUg3TTub8JhhtoWVSWiR5OiyvmVm8IrkeXocWDlFDqTdm17t/M9WY3IuWgYRBbDERNKkURm2nDv7KX3ZzSW+KpOQy29tGxAFYyEU/I1YJnXg1UcsvRs81D2VwhXw5matAx3YAgMPdrTlRNQx/tfs+99PWK83/5RM/LIr8d3YaISWpIyS5ywInFml8xAkqzw2kP39CYKzZF6IZ8hf1W5LzLG7OG2P2oiZgvXodyahcuiKaLdPBBf2OUVbmDGr/ZyGV3WEg+WJy7xTf/nhApFxKcKIzUETLGJ51BemF+cVQ9S0Ks43uWWgulLw09EcY3VUCOBX0hnLn42UIfFzwkHjZks2zXZ1szPxc0BNXaPTY6Ylcpw+gtq1d3WcYFujD5Idr8iL2jWbYIpZ+Z8HFHSXft6dbLmyKnCZCmrkF5GDCDchadf7lULYofSFsd3NYBNOirsa2oMCM53iy5Yog1DMWbHjVmcHLqS/XSvR/inQySW6soVWg9+dUo627L8K5OHH8ENkjlILv7BnXfty3yEjCpeNuqx/oNqXf1bFo25I=
install:
  # - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install portaudio; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install mpg123; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then gem install soundcloud9000; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then yes y | gem uninstall audite --force; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then gem install --user audite -- --with-ldflags="-lmpg123"; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install portaudio19-dev libmpg123-dev libncurses-dev ruby-dev; fi
  - gem install bundler:1.17.1
script:
  - gem build soundcloud9000.gemspec
  - sudo gem install soundcloud9000-0.1.3.gem
  - sudo gem uninstall soundcloud9000-0.1.3.gem
  - bundle _1.17.1_ install --path vendor/bundle
  - bundle _1.17.1_ exec rake install:local
